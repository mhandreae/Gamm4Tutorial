---
title: "Gamm4Tutorial"
author: "Michael Andreae"
date: "February 22, 2016"
output: pdf_document
---

# Introduction

This is a tutorial on analysing the cognitive decline dataset by Drs. Lipton and Hall using a generalized additive mixed models inspired and guided by the book \href{http://www.highstat.com/BGGAMM.htm}{A Beginner's Guide to Generalized Additive Mixed Models with R. Zuur AF, Saveliev AA, Ieno EN.}

```{r knitr, echo=FALSE}
suppressWarnings(library(knitr))
```

```{r globle_knitr_options, echo=FALSE}
rm(list=ls())
suppressWarnings(library(knitr))
# set options
opts_chunk$set(fig.width=6, fig.height=4, fig.path='Figs/',
               echo=FALSE, warning=FALSE, message=FALSE)
eval_everything=FALSE
```


```{r library}

library(ggplot2)
library(mgcv)
# library(parallel)
# require(knitr)
# library(tidyr)
# library(rstan)
# library(rstanarm)
# library(shinystan)
# library(nlme)
# library(dplyr)
```

## Import and load data

We import \href{http://www.highstat.com/BGS/GAMM/Data/SquidNorway.txt}{the squid dataset} from the website and save it as *SquidNorway.Rdata*

```{r import_squid_data, eval=FALSE}
Squid <- read.table(file= "SquidNorway.txt", header = TRUE, dec = ".")
save(Squid, file="SquidNorway.Rdata")
```

## Load data

We load the *SquidNorway.Rdata* file and fit a linear regression, plot the standardized residuals against the predictor length *ML*

```{r load_SquidNorway}
load("SquidNorway.Rdata")
str(Squid)
M1 <- lm(d15N ~ Lat +ML, data=Squid)
Squid$E1 <- rstandard(M1)

p <- ggplot(Squid, aes(ML, E1)) +
  geom_point() +
  geom_smooth()
p +xlab("ML") +
  ylab("standardized residuals") +theme_minimal() +
  geom_hline(yintercept = 0)
```

## Fit GAM

We fit a first generalized additive model using *gam* from the package *mgcv*, using different smoothers and plot the smoothers

```{r first_GAM}
M2A <- gam(d15N ~ Lat +s(ML), data=Squid)
M3A <- gam(d15N ~ Lat +s(ML, bs="cr"), data=Squid)
M4A <- gam(d15N ~ Lat +s(ML, bs ="ps"), data=Squid)
M5A <- gam(d15N ~ Lat +s(ML, bs="cs"), data=Squid)

plot(M2A)
plot(M3A)
plot(M4A)
plot(M5A)
```

